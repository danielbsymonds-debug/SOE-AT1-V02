<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>{{ subject or "Quiz" }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <style>
        /* ensure each radio option appears on its own line and is easy to click */
        .option-label {
            display: block;
            margin: 6px 0;
            cursor: pointer;
            padding: 6px;
            border-radius: 4px;
        }
        .question {
            margin-bottom: 18px;
        }
        .correct {
            background: #d4f7d4;
            border: 1px solid #3cb043;
        }
        .wrong {
            background: #ffd6d6;
            border: 1px solid #d9534f;
        }
        .disabled {
            opacity: 0.9;
            cursor: default;
        }
        .score {
            font-weight: bold;
            margin-bottom: 12px;
        }
    </style>
</head>
<body>
  <main>
    <h1>{{ subject or "Quiz" }}</h1>

    {% if review and score is defined %}
        <div class="score">Your score: {{ score }} / {{ total }}</div>
    {% endif %}

    {% if not questions %}
      <p>No questions available.</p>
      <a href="{{ url_for('home') }}">Back to Home</a>
    {% else %}
      <form method="post" action="{{ url_for('submit_quiz') }}">
        {% for q in questions %}
          {% set qnum = loop.index %}  {# capture outer loop index before entering inner loop so it's not shadowed #}
          <div class="question">
            <p><strong>Question {{ qnum }}:</strong> {{ q.question }}</p>
            <div>
              {% set choices = q.answers if q.answers is defined else [q.answer1,q.answer2,q.answer3,q.answer4] %}
              {% for choice_idx in range(1, 5) %}
                  {% set choice_text = choices[choice_idx-1] %}
                  {% set selected = (q.selected|string) == (choice_idx|string) %}
                  {% set correct = (q.correct|string) == (choice_idx|string) %}
                  {% set cls = "" %}
                  {% if review %}
                      {% if correct %}
                          {% set cls = "option-label correct disabled" %}
                      {% elif selected and not correct %}
                          {% set cls = "option-label wrong disabled" %}
                      {% else %}
                          {% set cls = "option-label disabled" %}
                      {% endif %}
                  {% else %}
                      {% set cls = "option-label" %}
                  {% endif %}
                  <label class="{{ cls }}">
                      <input type="radio"
                             name="q{{ qnum }}"                {# use qnum (outer index) so each question has distinct name #}
                             value="{{ choice_idx }}"
                             {% if review %} disabled {% endif %}
                             {% if selected %} checked {% endif %}>
                      {{ choice_text }}
                      {% if review and selected and not correct %}
                          <!-- show the correct answer text as additional hint -->
                          <div style="margin-left:18px;color:#3cb043;font-weight:bold;">
                              Correct: {{ choices[(q.correct|int)-1] if q.correct else '' }}
                          </div>
                      {% endif %}
                  </label>
              {% endfor %}
            </div>
          </div>
          <hr>
        {% endfor %}

        {% if not review %}
            <button type="submit">Submit Quiz</button>
        {% endif %}
      </form>
    {% endif %}
    <div style="margin-top:20px;">
      <a href="{{ url_for('home') }}"><button type="button">Return Home</button></a>
    </div>
    </main>
</body>
</html>